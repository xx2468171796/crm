/**
 * OpenCC Lite - 轻量级简繁转换
 * 用于客户门户繁体中文显示
 */

(function(global) {
  'use strict';

  // 简体到繁体映射表（常用字）
  const s2tMap = {
    // 常用动词
    '确': '確', '认': '認', '设': '設', '计': '計', '进': '進',
    '验': '驗', '证': '證', '访': '訪', '问': '問', '欢': '歡',
    '迎': '迎', '载': '載', '开': '開', '关': '關', '发': '發',
    '现': '現', '显': '顯', '见': '見', '视': '視', '观': '觀',
    '览': '覽', '读': '讀', '写': '寫', '记': '記', '录': '錄',
    '编': '編', '辑': '輯', '选': '選', '择': '擇', '创': '創',
    '建': '建', '删': '刪', '除': '除', '修': '修', '改': '改',
    '复': '復', '制': '製', '粘': '粘', '贴': '貼', '剪': '剪',
    '传': '傳', '输': '輸', '导': '導', '继': '繼', '续': '續',
    '执': '執', '运': '運', '动': '動', '启': '啟', '连': '連',
    '接': '接', '断': '斷', '联': '聯', '络': '絡', '网': '網',
    '购': '購', '买': '買', '卖': '賣', '订': '訂', '单': '單',
    '还': '還', '须': '須', '应': '應', '该': '該', '让': '讓',
    '请': '請', '谢': '謝', '对': '對', '错': '錯', '试': '試',
    
    // 常用名词
    '项': '項', '页': '頁', '码': '碼', '号': '號', '机': '機',
    '电': '電', '话': '話', '邮': '郵', '件': '件', '图': '圖',
    '画': '畫', '档': '檔', '库': '庫', '盘': '盤', '纸': '紙',
    '书': '書', '报': '報', '纪': '紀', '钟': '鐘', '时': '時',
    '间': '間', '业': '業', '务': '務', '贸': '貿', '易': '易',
    '银': '銀', '钱': '錢', '币': '幣', '帐': '帳', '账': '賬',
    '财': '財', '产': '產', '资': '資', '经': '經', '济': '濟',
    '团': '團', '队': '隊', '员': '員', '师': '師', '师': '師',
    '医': '醫', '药': '藥', '护': '護', '险': '險', '厂': '廠',
    '场': '場', '馆': '館', '园': '園', '楼': '樓', '层': '層',
    '车': '車', '辆': '輛', '船': '船', '飞': '飛', '机': '機',
    '战': '戰', '军': '軍', '队': '隊', '党': '黨', '组': '組',
    '织': '織', '构': '構', '门': '門', '户': '戶', '窗': '窗',
    '厅': '廳', '室': '室', '厨': '廚', '卫': '衛', '阳': '陽',
    '龙': '龍', '凤': '鳳', '鸟': '鳥', '鱼': '魚', '马': '馬',
    '虫': '蟲', '风': '風', '云': '雲', '雨': '雨', '雪': '雪',
    '头': '頭', '脑': '腦', '脸': '臉', '眼': '眼', '耳': '耳',
    '鼻': '鼻', '齿': '齒', '发': '髮', '须': '鬚', '胡': '鬍',
    
    // 常用形容词
    '优': '優', '质': '質', '热': '熱', '冷': '冷', '温': '溫',
    '暖': '暖', '凉': '涼', '干': '乾', '湿': '濕', '轻': '輕',
    '重': '重', '长': '長', '短': '短', '宽': '寬', '窄': '窄',
    '高': '高', '矮': '矮', '胖': '胖', '瘦': '瘦', '强': '強',
    '弱': '弱', '硬': '硬', '软': '軟', '紧': '緊', '松': '鬆',
    '满': '滿', '饱': '飽', '饿': '餓', '渴': '渴', '累': '累',
    '闲': '閒', '忙': '忙', '静': '靜', '闹': '鬧', '脏': '髒',
    '净': '淨', '整': '整', '乱': '亂', '简': '簡', '繁': '繁',
    '难': '難', '双': '雙', '杂': '雜', '纯': '純', '真': '真',
    '假': '假', '实': '實', '虚': '虛', '旧': '舊', '新': '新',
    '坏': '壞', '丑': '醜', '美': '美', '贵': '貴', '贱': '賤',
    '亲': '親', '疏': '疏', '远': '遠', '近': '近', '陌': '陌',
    
    // 状态词
    '状': '狀', '态': '態', '况': '況', '情': '情', '绪': '緒',
    '成': '成', '功': '功', '败': '敗', '胜': '勝', '负': '負',
    '赢': '贏', '输': '輸', '获': '獲', '得': '得', '失': '失',
    '增': '增', '减': '減', '加': '加', '升': '升', '降': '降',
    '涨': '漲', '跌': '跌', '变': '變', '换': '換', '转': '轉',
    '终': '終', '结': '結', '束': '束', '止': '止', '毕': '畢',
    '完': '完', '待': '待', '审': '審', '批': '批', '核': '核',
    '准': '準', '许': '許', '禁': '禁', '限': '限', '锁': '鎖',
    
    // 量词/单位
    '个': '個', '条': '條', '张': '張', '块': '塊', '只': '隻',
    '双': '雙', '对': '對', '副': '副', '套': '套', '台': '臺',
    '辆': '輛', '艘': '艘', '架': '架', '栋': '棟', '间': '間',
    '层': '層', '节': '節', '段': '段', '篇': '篇', '章': '章',
    
    // 介词/连词
    '与': '與', '于': '於', '为': '為', '从': '從', '向': '向',
    '将': '將', '把': '把', '被': '被', '给': '給', '跟': '跟',
    '并': '並', '且': '且', '而': '而', '或': '或', '则': '則',
    '虽': '雖', '然': '然', '但': '但', '却': '卻', '只': '只',
    '仅': '僅', '才': '才', '就': '就', '即': '即', '便': '便',
    
    // 门户相关
    '沟': '溝', '通': '通', '填': '填', '交': '交', '付': '付',
    '表': '表', '需': '需', '求': '求', '作': '作', '品': '品',
    '稿': '稿', '工': '工', '校': '校', '评': '評', '价': '價',
    '料': '料', '管': '管', '理': '理', '客': '客', '服': '服',
    '提': '提', '醒': '醒', '消': '消', '息': '息', '点': '點',
    '击': '擊', '返': '返', '回': '回', '退': '退', '出': '出',
    '登': '登', '入': '入', '注': '註', '册': '冊', '密': '密',
    '输': '輸', '确': '確', '认': '認', '取': '取', '消': '消',
    
    // 数字相关
    '万': '萬', '亿': '億', '余': '餘', '几': '幾', '两': '兩',
    
    // 时间相关
    '历': '曆', '岁': '歲', '龄': '齡', '纪': '紀', '钟': '鐘',
    '秒': '秒', '过': '過', '后': '後', '当': '當', '临': '臨',
    
    // 其他常用
    '体': '體', '类': '類', '种': '種', '级': '級', '别': '別',
    '系': '系', '统': '統', '程': '程', '序': '序', '标': '標',
    '准': '準', '则': '則', '例': '例', '规': '規', '范': '範',
    '据': '據', '数': '數', '信': '信', '息': '息', '容': '容',
    '义': '義', '意': '意', '思': '思', '想': '想', '念': '念',
    '虑': '慮', '忆': '憶', '志': '誌', '愿': '願', '望': '望',
    '盼': '盼', '期': '期', '待': '待', '希': '希', '望': '望',
    '预': '預', '测': '測', '估': '估', '算': '算', '查': '查',
    '找': '找', '搜': '搜', '索': '索', '调': '調', '研': '研',
    '究': '究', '探': '探', '讨': '討', '论': '論', '谈': '談',
    '话': '話', '语': '語', '言': '言', '词': '詞', '句': '句',
    '声': '聲', '音': '音', '响': '響', '听': '聽', '说': '說',
    '讲': '講', '叙': '敘', '述': '述', '描': '描', '绘': '繪',
    '画': '畫', '写': '寫', '注': '註', '解': '解', '释': '釋',
    '译': '譯', '版': '版', '权': '權', '证': '證', '明': '明',
    '示': '示', '宣': '宣', '告': '告', '布': '佈', '公': '公',
    '开': '開', '私': '私', '密': '密', '秘': '秘', '保': '保',
    '护': '護', '卫': '衛', '防': '防', '守': '守', '攻': '攻',
    '击': '擊', '打': '打', '斗': '鬥', '争': '爭', '战': '戰',
    '赛': '賽', '比': '比', '较': '較', '衡': '衡', '量': '量',
    '称': '稱', '呼': '呼', '唤': '喚', '叫': '叫', '喊': '喊',
    '吵': '吵', '闹': '鬧', '哭': '哭', '笑': '笑', '乐': '樂',
    '悲': '悲', '伤': '傷', '痛': '痛', '苦': '苦', '恼': '惱',
    '怒': '怒', '惧': '懼', '怕': '怕', '恐': '恐', '慌': '慌',
    '张': '張', '紧': '緊', '急': '急', '慢': '慢', '稳': '穩',
    '处': '處', '办': '辦', '理': '理', '解': '解', '决': '決',
    '定': '定', '确': '確', '保': '保', '证': '證', '险': '險',
    '担': '擔', '当': '當', '负': '負', '责': '責', '任': '任',
    '务': '務', '职': '職', '份': '份', '角': '角', '色': '色',
    '份': '份', '额': '額', '度': '度', '率': '率', '价': '價',
    '值': '值', '格': '格', '惠': '惠', '利': '利', '益': '益',
    '损': '損', '亏': '虧', '赚': '賺', '挣': '掙', '花': '花',
    '费': '費', '用': '用', '省': '省', '节': '節', '约': '約',
    '储': '儲', '存': '存', '蓄': '蓄', '积': '積', '累': '累',
    '借': '借', '贷': '貸', '还': '還', '偿': '償', '清': '清',
    '结': '結', '算': '算', '帐': '帳', '户': '戶', '核': '核',
    '对': '對', '账': '賬', '错': '錯', '漏': '漏', '遗': '遺',
    '补': '補', '填': '填', '充': '充', '满': '滿', '足': '足',
    '够': '夠', '多': '多', '少': '少', '余': '餘', '缺': '缺',
    '乏': '乏', '空': '空', '白': '白', '黑': '黑', '红': '紅',
    '黄': '黃', '绿': '綠', '蓝': '藍', '紫': '紫', '橙': '橙',
    '灰': '灰', '棕': '棕', '褐': '褐', '粉': '粉', '银': '銀',
    '金': '金', '铜': '銅', '铁': '鐵', '钢': '鋼', '铝': '鋁',
    '锡': '錫', '锌': '鋅', '镍': '鎳', '铅': '鉛', '汞': '汞',
    
    // 补充常用
    '么': '麼', '着': '著', '这': '這', '那': '那', '里': '裡',
    '边': '邊', '面': '面', '旁': '旁', '侧': '側', '前': '前',
    '后': '後', '左': '左', '右': '右', '上': '上', '下': '下',
    '内': '內', '外': '外', '中': '中', '东': '東', '西': '西',
    '南': '南', '北': '北', '底': '底', '顶': '頂', '角': '角',
    '尖': '尖', '端': '端', '初': '初', '末': '末', '首': '首',
    '尾': '尾', '身': '身', '手': '手', '脚': '腳', '腿': '腿',
    '臂': '臂', '肩': '肩', '背': '背', '胸': '胸', '腰': '腰',
    '肚': '肚', '腹': '腹', '心': '心', '肝': '肝', '肺': '肺',
    '肾': '腎', '胃': '胃', '肠': '腸', '血': '血', '骨': '骨',
    '肉': '肉', '皮': '皮', '毛': '毛', '爪': '爪', '牙': '牙'
  };

  // 繁体到简体映射表（反向映射）
  const t2sMap = {};
  for (const [s, t] of Object.entries(s2tMap)) {
    t2sMap[t] = s;
  }

  /**
   * 简体转繁体
   * @param {string} text - 简体中文文本
   * @returns {string} 繁体中文文本
   */
  function toTraditional(text) {
    if (!text || typeof text !== 'string') return text;
    
    let result = '';
    for (let i = 0; i < text.length; i++) {
      const char = text[i];
      result += s2tMap[char] || char;
    }
    return result;
  }

  /**
   * 繁体转简体
   * @param {string} text - 繁体中文文本
   * @returns {string} 简体中文文本
   */
  function toSimplified(text) {
    if (!text || typeof text !== 'string') return text;
    
    let result = '';
    for (let i = 0; i < text.length; i++) {
      const char = text[i];
      result += t2sMap[char] || char;
    }
    return result;
  }

  /**
   * 批量转换对象中的字符串属性
   * @param {object} obj - 包含字符串的对象
   * @param {string[]} keys - 需要转换的属性名（可选，不传则转换所有字符串属性）
   * @returns {object} 转换后的对象（新对象）
   */
  function convertObject(obj, keys) {
    if (!obj || typeof obj !== 'object') return obj;
    
    const result = Array.isArray(obj) ? [] : {};
    
    for (const key in obj) {
      if (!obj.hasOwnProperty(key)) continue;
      
      const value = obj[key];
      
      if (typeof value === 'string') {
        if (!keys || keys.includes(key)) {
          result[key] = toTraditional(value);
        } else {
          result[key] = value;
        }
      } else if (typeof value === 'object' && value !== null) {
        result[key] = convertObject(value, keys);
      } else {
        result[key] = value;
      }
    }
    
    return result;
  }

  /**
   * 转换 DOM 元素内的文本节点
   * @param {HTMLElement} element - 要转换的元素
   * @param {string[]} excludeTags - 排除的标签名（如 INPUT, TEXTAREA）
   */
  function convertElement(element, excludeTags = ['INPUT', 'TEXTAREA', 'SCRIPT', 'STYLE']) {
    if (!element) return;
    
    const walker = document.createTreeWalker(
      element,
      NodeFilter.SHOW_TEXT,
      {
        acceptNode: function(node) {
          const parent = node.parentElement;
          if (parent && excludeTags.includes(parent.tagName)) {
            return NodeFilter.FILTER_REJECT;
          }
          return NodeFilter.FILTER_ACCEPT;
        }
      }
    );

    const textNodes = [];
    while (walker.nextNode()) {
      textNodes.push(walker.currentNode);
    }

    textNodes.forEach(node => {
      if (node.textContent.trim()) {
        node.textContent = toTraditional(node.textContent);
      }
    });
  }

  // 导出到全局
  global.OpenCCLite = {
    toTraditional: toTraditional,
    toSimplified: toSimplified,
    convertObject: convertObject,
    convertElement: convertElement,
    t: toTraditional,  // 简写别名
    s: toSimplified    // 简写别名
  };

})(typeof window !== 'undefined' ? window : this);
